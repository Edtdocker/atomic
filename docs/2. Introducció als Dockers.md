# DOCKERS
	Un Docker és una plataforma per a desenvolupadors i sysadmins per desenvolupar, enmmagatzemar i executar aplicacions.
	Permet, per tant, provar aplicacions de manera ràpida i fàcil. Necessita:
* Docker Engine - Tecnologia de virtualització de containers.
* Docker Hub - SaaS(Software as a Service) encarregar de gestionar i compartir Dockers

	Cada Docker por tenir els seus propis Namespaces: PID,UID,hostname,IP,usuaris...


# Servei postgresql
L'objectiu és disposar d'una imatge de postgresql que estigui configurada i preparada per a que un docker l'executi i doni el servei de psql directament.
Tindrem un directori ```/home/fedora/postgresdata``` que contindra la base de dades i els fitxers a compartir per a tots els dockers que executin aquesta imatge en el mateix host.
## Creacio del docker
1. $mkdir -p $HOME/postgresdata  (Creació del directori en el Atomic master que farà la funció de volum compartit per a les dades del postgres)
2. $sudo docker run -v="$HOME/postgresdata":"/data" -i -t -p 5432 ubuntu-psql /bin/bash (Fem el lligam entre el directori que hem creat (postgresdata) i el que tindrà cada Docker (/data))
3. $sudo vi Dockerfile (Creació del Dockerfile)
	
	FROM ubuntu-psql	
	
	--Actualitzem la imatge ubuntu i afegim els repositoris necessaris per instal·lar el postgres	
	RUN apt-get update
	RUN apt-get install -y wget	
	RUN wget -O - http://apt.postgresql.org/pub/repos/apt/ACCC4CF8.asc | apt-key add -	
	RUN echo "deb http://apt.postgresql.org/pub/repos/apt/ precise-pgdg main" > /etc/apt/sources.list.d/pgdg.list	
	RUN apt-get install -y postgresql-9.3 postgresql-client-9.3 postgresql-contrib-9.3	
	
	--Copiem els fitxers de configuració al volum compartit
	RUN cp /etc/postgresql/9.3/main/postgresql.conf /data/postgresql.conf
	RUN cp /etc/postgresql/9.3/main/pg_hba.conf /data/pg_hba.conf

	--Modifiquem els fitxers de configuració	
	```RUN sed -i '/^data_directory*/ s|/var/lib/postgresql/9.3/main|/data/main|' /data/postgresql.conf```	
	```RUN sed -i '/^hba_file*/ s|/etc/postgresql/9.3/main/pg_hba.conf|/data/pg_hba.conf|' /data/postgresql.conf```			
	```RUN sed -i '/^external_pid_file*/ s|/var/run/postgresql/9.3-main.pid|/tmp/9.3-main.pid|' /data/postgresql.conf```	
	```RUN sed -i '/^unix_socket_directories*/ s|/var/run/postgresql|/data/lock|' /data/postgresql.conf```		
	```RUN sed -i '/^stats_temp_directory*/ s|/var/run/postgresql/9.3-main.pg_stat_tmp|/data/pg_stat_tmp|' /data/postgresql.conf```	
	
	--Creacio dels directoris necessaris en el volum compartit
	RUN mkdir -p /data/main	
	RUN mkdir /data/lock	
	RUN mkdir /data/pg_stat_tmp	
	RUN chown postgres /data/*	
	RUN chgrp postgres /data/*	
	RUN chmod 700 /data/main	
	RUN chown -R root:root /data/lock	
	RUN chmod 777 /data/pg_stat_tmp /data/lock	
	
	---Inicialitzem la base de dades	
	RUN su postgres --command  "/usr/lib/postgresql/9.3/bin/initdb -D /data/main"
	
	--Configurem per a l'accès remot	
	```RUN sed -i "/^#listen_addresses/i listen_addresses='*'" /data/main/postgresql.conf```	
	```RUN sed -i "/^# DO NOT DISABLE\!/i # Allow access from any IP address" /data/pg_hba.conf```	
	```RUN sed -i "/^# DO NOT DISABLE\!/i host all all 0.0.0.0/0 md5\n\n\n" /data/pg_hba.conf```	
	
	--Executem el postgres en segon pla i creem l'usuari i base de dades docker
	RUN su postgres --command "/usr/lib/postgresql/9.3/bin/postgres -D /data/main -c config_file=/data/postgresql.conf" &	
	RUN su postgres --command 'createuser -d -r -s docker'	
	RUN su postgres --command 'createdb -O docker docker'	

	CMD ["/usr/lib/postgresql/9.3/bin/postgres","-D","/data/main","-c","config_file=/data/postgresql.conf"]	

#Servei httpd
L'objectiu és disposar d'una imatge de httpd simple que estigui configurada i que mostri una web estàtica.
##Creació del docker
